# === Database ===
POSTGRES_DB=ragchat
POSTGRES_USER=ragchat
POSTGRES_PASSWORD=ragchat

# === Redis (rate-limit backend, optional but recommended for multi-instance) ===
SPRING_REDIS_HOST=localhost
SPRING_REDIS_PORT=6379
SPRING_REDIS_PASSWORD=

# === Security ===
# Supported modes: API_KEY or JWT
APP_SECURITY_MODE=API_KEY

# -- API_KEY mode --
# REQUIRED - all API requests must send header: X-API-Key: <this value>
APP_SECURITY_API_KEY=change-me
# REQUIRED - all API requests must send this header too (defaults to X-User-Id)
APP_SECURITY_USER_ID_HEADER=X-User-Id

# --- Authorization roles ---
# When true, roles are looked up from the DB at request-time based on the userId header.
# This enables real-time role changes.
APP_SECURITY_RESOLVE_ROLES_FROM_DB=true
# When true (and DB roles are enabled), requests are rejected if userId is unknown/inactive.
APP_SECURITY_REQUIRE_USER_IN_DB=true

# Optional: fallback/base roles from config (used when APP_SECURITY_RESOLVE_ROLES_FROM_DB=false)
# APP_SECURITY_ROLES=CHAT_ADMIN,CHAT_READ,CHAT_WRITE,CHAT_DELETE
# Optional: grant legacy ROLE_API to every authenticated request (bypasses fine-grained roles if enabled)
# APP_SECURITY_GRANT_API_ROLE=true

# -- JWT mode --
# Configure Spring's resource server properties (choose ONE of issuer-uri or jwk-set-uri)
# SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI=https://issuer.example.com/
# SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI=https://issuer.example.com/.well-known/jwks.json

# === Rate Limiting ===
APP_RATE_LIMIT_ENABLED=true
# Use REDIS for multi-instance deployments
APP_RATE_LIMIT_BACKEND=REDIS   # IN_MEMORY|REDIS
# Fixed-window: capacity requests per window
APP_RATE_LIMIT_CAPACITY=120
APP_RATE_LIMIT_REFILL_DURATION_SECONDS=60

# === CORS ===
APP_CORS_ENABLED=true
APP_CORS_ALLOWED_ORIGINS=http://localhost:3000
APP_CORS_ALLOWED_METHODS=GET,POST,PATCH,DELETE,OPTIONS
APP_CORS_ALLOWED_HEADERS=Content-Type,X-API-Key,X-User-Id,Authorization

# === Encryption at rest (application-level AES-GCM) ===
APP_ENCRYPTION_ENABLED=false
APP_ENCRYPTION_PROVIDER=LOCAL   # NONE|LOCAL|AWS_KMS
# Base64 encoded 32-byte key recommended. Example generation:
#   python -c "import os,base64; print(base64.b64encode(os.urandom(32)).decode())"
APP_ENCRYPTION_LOCAL_KEY_BASE64=

# === Retention / soft-delete purge ===
APP_RETENTION_ENABLED=true
# Hard delete sessions inactive for N days (updated_at older than this)
APP_RETENTION_HARD_DELETE_AFTER_DAYS=180
# Permanently delete soft-deleted sessions after N days
APP_RETENTION_SOFT_DELETE_GRACE_DAYS=30
# Cron for purge job (Spring 6-field cron, default daily 03:00 UTC)
APP_RETENTION_CRON=0 0 3 * * *
